# Generating a dataset for mothers from 1980 - 2022
data_women_1980_2022 <- data %>%
filter(year %in% c(1980, 1990, 1995, 2012, 2014, 2016, 2018, 2020, 2022),
sex == 2) %>%
mutate(frage = ifelse(frage1 == 0, NA, frage1 / 12),
age_first_birth = case_when(is.na(frage) ~ NA,
frage < 20 ~ "< 19",
frage < 25 ~ "20-24",
frage < 30 ~ "25-29",
frage < 35 ~ "30-34",
frage < 40 ~ "35-39",
frage < 45 ~ "40-44",
TRUE ~ "> 45"),
age_first_birth = fct_relevel(age_first_birth,
"< 19", "20-24", "25-29", "30-34", "35-39", "40-44", "> 45"),
educational_level = case_when(educ %in% 2:32 ~ "Basic Education",
educ %in% 40:73 ~ "Secondary Education",
educ %in% 80:100 ~ "Tertiary Education",
educ %in% 110:125 ~ "University Degree"))
# Saving CPS fertility datasets
path_data_women_1980_2022 <- "refined/cps_women_1980_2022.csv"
# Saving CPS fertility datasets
path_data_women_1980_2022 <- "refined/cps_women_1980_2022.csv"
write.csv(data_women_1980_2022, file = path_data_women_1980_2022, row.names = FALSE)
###########################################################################
# Script: extract_cps_fertility.R
# Author: Gustavo Luchesi
# Last Updated: 8/29/2024
# Description: Extracts CPS dat file from raw and creates intermediate datasets
# based on the Fertility Supplement of the CPS
# Input: cps_00002.dat
# Output: cps_women_1980_2022.csv
###########################################################################
# Installing required packages
packages <- c("tidyverse", "ipumsr")
to_install <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(to_install) > 0) install.packages(to_install)
lapply(packages, require, character.only = TRUE)
# Clean workspace
rm(list = ls())
# Set working directory
setwd("C:/Users/gustavoml/Desktop/Projects/FertilityFacts")
# Loading extract into R
ddi <- read_ipums_ddi("raw/cps_00002.xml")
data <- read_ipums_micro(ddi)
names(data) <- tolower(names(data))
# Generating a dataset for mothers from 1980 - 2022
data_women_1980_2022 <- data %>%
filter(year %in% c(1980, 1990, 1995, 2012, 2014, 2016, 2018, 2020, 2022),
sex == 2) %>%
mutate(frage = ifelse(frage1 == 0, NA, frage1 / 12),
age_first_birth = case_when(is.na(frage) ~ NA,
frage < 20 ~ "< 19",
frage < 25 ~ "20-24",
frage < 30 ~ "25-29",
frage < 35 ~ "30-34",
frage < 40 ~ "35-39",
frage < 45 ~ "40-44",
TRUE ~ "> 45"),
age_first_birth = fct_relevel(age_first_birth,
"< 19", "20-24", "25-29", "30-34", "35-39", "40-44", "> 45"),
educational_level = case_when(educ %in% 2:32 ~ "Basic Education",
educ %in% 40:73 ~ "Secondary Education",
educ %in% 80:100 ~ "Tertiary Education",
educ %in% 110:125 ~ "University Degree"))
# Saving CPS fertility datasets
path_data_women_1980_2022 <- "refined/cps_women_1980_2022.csv"
write.csv(data_women_1980_2022, file = path_data_women_1980_2022, row.names = FALSE)
View(data_women_1980_2022)
# Generating a dataset for mothers from 1980 - 2022
data_women_1980_2022 <- data %>%
filter(year %in% c(1980, 1990, 1995, 2012, 2014, 2016, 2018, 2020, 2022),
sex == 2) %>%
mutate(frage = ifelse(frage1 %in% c(0, 999), NA, frage1 / 12),
age_first_birth = case_when(is.na(frage) ~ NA,
frage < 20 ~ "< 19",
frage < 25 ~ "20-24",
frage < 30 ~ "25-29",
frage < 35 ~ "30-34",
frage < 40 ~ "35-39",
frage < 45 ~ "40-44",
TRUE ~ "> 45"),
age_first_birth = fct_relevel(age_first_birth,
"< 19", "20-24", "25-29", "30-34", "35-39", "40-44", "> 45"),
educational_level = case_when(educ %in% 2:32 ~ "Basic Education",
educ %in% 40:73 ~ "Secondary Education",
educ %in% 80:100 ~ "Tertiary Education",
educ %in% 110:125 ~ "University Degree"))
# Saving CPS fertility datasets
path_data_women_1980_2022 <- "refined/cps_women_1980_2022.csv"
write.csv(data_women_1980_2022, file = path_data_women_1980_2022, row.names = FALSE)
table(data_women_1980_2022$frever)
table(data_women_1980_2022$frever[year == 2022])
table(data_women_1980_2022 %>% filter(year == 2022))
test <- data_women_1980_2022 %>% filter(year == 2022)
table(test$frever)
test <- data_women_1980_2022 %>% filter(year == 2020)
table(test$frever)
test <- data_women_1980_2022 %>% filter(year == 2018)
table(test$frever)
test <- data_women_1980_2022 %>% filter(year == 2016)
table(test$frever)
test <- data_women_1980_2022 %>% filter(year == 2014)
table(test$frever)
test <- data_women_1980_2022 %>% filter(year == 2012)
table(test$frever)
test <- data_women_1980_2022 %>% filter(year == 1995)
table(test$frever)
test <- data_women_1980_2022 %>% filter(year == 1990)
table(test$frever)
test <- data_women_1980_2022 %>% filter(year == 1980)
table(test$frever)
# Installing required packages
packages <- c("tidyverse", "ipumsr")
to_install <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(to_install) > 0) install.packages(to_install)
lapply(packages, require, character.only = TRUE)
# Clean workspace
rm(list = ls())
# Set working directory
setwd("C:/Users/gustavoml/Desktop/Projects/FertilityFacts")
# Loading extract into R
ddi <- read_ipums_ddi("raw/cps_00002.xml")
data <- read_ipums_micro(ddi)
names(data) <- tolower(names(data))
# Generating a dataset for mothers from 1980 - 2022
data_women_1980_2022 <- data %>%
filter(year %in% c(1980, 1990, 1995, 2012, 2014, 2016, 2018, 2020, 2022),
sex == 2) %>%
mutate(frage = ifelse(frage1 %in% c(0, 999), NA, frage1 / 12),
age_first_birth = case_when(is.na(frage) ~ NA,
frage < 20 ~ "< 19",
frage < 25 ~ "20-24",
frage < 30 ~ "25-29",
frage < 35 ~ "30-34",
frage < 40 ~ "35-39",
frage < 45 ~ "40-44",
TRUE ~ "> 45"),
age_first_birth = fct_relevel(age_first_birth,
"< 19", "20-24", "25-29", "30-34", "35-39", "40-44", "> 45"),
educational_level = case_when(educ %in% 2:32 ~ "Basic Education",
educ %in% 40:73 ~ "Secondary Education",
educ %in% 80:100 ~ "Tertiary Education",
educ %in% 110:125 ~ "University Degree"))
View(data_women_1980_2022)
# Saving CPS fertility datasets
path_data_women_1980_2022 <- "refined/cps_women_1980_2022.csv"
write.csv(data_women_1980_2022, file = path_data_women_1980_2022, row.names = FALSE)
# Installing required packages
packages <- c("tidyverse", "viridis")
to_install <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(to_install) > 0) install.packages(to_install)
lapply(packages, require, character.only = TRUE)
# Clean workspace
rm(list = ls())
# Set working directory
setwd("C:/Users/gustavoml/Desktop/Projects/FertilityFacts")
# Load intermediate datasets
mothers_1980_2022 <- read.csv("refined/cps_women_1980_2022.csv")
View(mothers_1980_2022)
# Load intermediate datasets
women_1980_2022 <- read.csv("refined/cps_women_1980_2022.csv")
women_1980_2022 <- read.csv("refined/cps_women_1980_2022.csv")
women_1980_2022 <- women_1980_2022 %>%
mutate(age_first_birth = fct_relevel(age_first_birth,
"< 19", "20-24", "25-29", "30-34", "35-39", "40-44", "> 45"))
View(women_1980_2022)
women_1980_2022 %>%
# Filter only women who ever gave birth and who have completed their fertility
filter(!(frever %in% c(0, 999)),
age >= 45) %>%
group_by(year, age_first_birth) %>%
summarise(children_per_woman = weighted.mean(frever, wtfinl),
children_per_woman_unw = mean(frever)) %>%
ungroup()
women_1980_2022 %>%
# Filter only women who ever gave birth and who have completed their fertility
filter(!(frever %in% c(0, 999)),
age >= 45) %>%
group_by(year, age_first_birth) %>%
summarise(children_per_woman = weighted.mean(frever, wtfinl),
children_per_woman_unw = mean(frever),
n_women = n()) %>%
ungroup()
# Generating numbers for Fertility by Age at First Birth and Educational Attainment
total_fertility <- women_1980_2022 %>%
# Filter only women who ever gave birth and who have completed their fertility
filter(!(frever %in% c(0, 999)),
age >= 45) %>%
group_by(year, age_first_birth) %>%
summarise(children_per_woman = weighted.mean(frever, wtfinl),
children_per_woman_unw = mean(frever),
n_women = n()) %>%
ungroup()
View(total_fertility)
## Total Fertility by Age of First Birth
total_fertility %>%
filter(YEAR %in% (1980,2022)) %>%
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% (1980,2022)) %>%
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = year)) +
geom_col() +
theme_minimal()
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:",
caption = "Source: Fertility Supplement of the Current Population Survey") +
theme_minimal() +
theme(legend.position = "bottom")
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "bottom")
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "right")
bottom
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "bottom")
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "bottom",
axis.text = element_text(size = 10),
axis.line = element_line(),
axis.ticks = element_line(),
panel.grid = element_blank())
# Installing required packages
packages <- c("tidyverse", "viridis", "stargazer")
to_install <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(to_install) > 0) install.packages(to_install)
lapply(packages, require, character.only = TRUE)
# Clean workspace
rm(list = ls())
# Set working directory
setwd("C:/Users/gustavoml/Desktop/Projects/FertilityFacts")
# Load intermediate datasets
women_1980_2022 <- read.csv("refined/cps_women_1980_2022.csv")
women_1980_2022 <- women_1980_2022 %>%
mutate(age_first_birth = fct_relevel(age_first_birth,
"< 19", "20-24", "25-29", "30-34", "35-39", "40-44", "> 45"))
# Generating numbers for Fertility by Age at First Birth and Educational Attainment
total_fertility <- women_1980_2022 %>%
# Filter only women who ever gave birth and who have completed their fertility
filter(!(frever %in% c(0, 999)),
age >= 45) %>%
group_by(year, age_first_birth) %>%
summarise(children_per_woman = weighted.mean(frever, wtfinl),
children_per_woman_unw = mean(frever),
n_women = n()) %>%
ungroup()
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
scale_fill_viridis(option = "viridis") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "bottom",
axis.text = element_text(size = 10),
axis.line = element_line(),
axis.ticks = element_line(),
panel.grid = element_blank())
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
scale_fill_viridis_d(option = "viridis") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "bottom",
axis.text = element_text(size = 10),
axis.line = element_line(),
axis.ticks = element_line(),
panel.grid = element_blank())
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
scale_fill_viridis_d(option = "plasma") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "bottom",
axis.text = element_text(size = 10),
axis.line = element_line(),
axis.ticks = element_line(),
panel.grid = element_blank())
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
scale_fill_brewer() +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "bottom",
axis.text = element_text(size = 10),
axis.line = element_line(),
axis.ticks = element_line(),
panel.grid = element_blank())
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
scale_fill_brewer(palette = "Set1") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "bottom",
axis.text = element_text(size = 10),
axis.line = element_line(),
axis.ticks = element_line(),
panel.grid = element_blank())
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
scale_fill_brewer(palette = "paired") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "bottom",
axis.text = element_text(size = 10),
axis.line = element_line(),
axis.ticks = element_line(),
panel.grid = element_blank())
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
scale_fill_brewer(palette = "Paired") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "bottom",
axis.text = element_text(size = 10),
axis.line = element_line(),
axis.ticks = element_line(),
panel.grid = element_blank())
View(total_fertility)
## Total Fertility by Age of First Birth
total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
scale_fill_brewer(palette = "Paired") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "top",
axis.text = element_text(size = 10),
axis.line = element_line(),
axis.ticks = element_line(),
panel.grid = element_blank())
## Total Fertility by Age of First Birth
plot <- total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
scale_fill_brewer(palette = "Paired") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "top",
axis.text = element_text(size = 10),
axis.line = element_line(),
axis.ticks = element_line(),
panel.grid = element_blank())
path <- "figures/cps_total_fertility.jpeg"
path_overleaf <- "overleaf/cps_total_fertility.jpeg"
ggsave(filename = path, plot = figure, dpi = 320, width = 6, height = 5)
ggsave(filename = path_overleaf, plot = figure, dpi = 320, width = 6, height = 5)
## Total Fertility by Age of First Birth
plot_fertility <- total_fertility %>%
filter(year %in% c(1980,2022)) %>%
ggplot(aes(x = age_first_birth, y = children_per_woman, fill = as.factor(year))) +
geom_col(position = "dodge") +
scale_fill_brewer(palette = "Paired") +
labs(x = "Age at First Birth",
y = "Children per woman",
fill = "Year:") +
theme_minimal() +
theme(legend.position = "top",
axis.text = element_text(size = 10),
axis.line = element_line(),
axis.ticks = element_line(),
panel.grid = element_blank())
path <- "figures/cps_total_fertility.jpeg"
path_overleaf <- "overleaf/cps_total_fertility.jpeg"
ggsave(filename = path, plot = plot_fertility, dpi = 320, width = 6, height = 5)
ggsave(filename = path_overleaf, plot = plot_fertility, dpi = 320, width = 6, height = 5)
# Installing required packages
packages <- c("tidyverse", "viridis")
to_install <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(to_install) > 0) install.packages(to_install)
lapply(packages, require, character.only = TRUE)
# Clean workspace
rm(list = ls())
# Set working directory
setwd("C:/Users/gustavoml/Desktop/Projects/FertilityFacts")
# Load intermediate dataset
acs_data <- read.csv("refined/acs_percent_pregnant_cohorts.csv")
# Fertility by age across cohorts
acs_figure <- acs_data %>%
ggplot(aes(x = AGE, y = PERCENT_PREGNANT, color = YEAR, group = YEAR)) +
geom_line() +
labs(title = "Did you give birth to a child in the last 12 months?",
x = "Age of Woman",
color = "Year") +
scale_y_continuous(labels = scales::label_percent(accuracy = 0.1),
limits = c(0, 0.13),
n.breaks = 6) +
scale_color_viridis(option = "D",
begin = 1,
end = 0) +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.line = element_line())
# Saving figures in output folder
figure_path <- "figures/acs_births_across_years.jpeg"
overleaf_path <- "overleaf/acs_births_across_years.jpeg"
ggsave(figure_path, plot = acs_figure, dpi = 320, width = 6, height = 6)
ggsave(overleaf_path, plot = acs_figure, dpi = 320, width = 6, height = 6)
View(acs_figure)
# Installing required packages
packages <- c("tidyverse", "viridis")
to_install <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(to_install) > 0) install.packages(to_install)
lapply(packages, require, character.only = TRUE)
# Clean workspace
rm(list = ls())
# Set working directory
setwd("C:/Users/gustavoml/Desktop/Projects/FertilityFacts")
# Load intermediate dataset
acs_data <- read.csv("refined/acs_percent_pregnant_cohorts.csv")
# Fertility by age across cohorts
acs_figure <- acs_data %>%
ggplot(aes(x = AGE, y = PERCENT_PREGNANT, color = YEAR, group = YEAR)) +
geom_line() +
labs(title = "Did you give birth to a child in the last 12 months?",
x = "Age of Woman",
color = "Year") +
scale_y_continuous(labels = scales::label_percent(accuracy = 0.1),
limits = c(0, 0.13),
n.breaks = 6) +
scale_color_viridis(option = "D",
begin = 1,
end = 0) +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.line = element_line())
# Saving figures in output folder
figure_path <- "figures/acs_births_across_years.jpeg"
overleaf_path <- "overleaf/acs_births_across_years.jpeg"
ggsave(figure_path, plot = acs_figure, dpi = 320, width = 6, height = 5)
ggsave(overleaf_path, plot = acs_figure, dpi = 320, width = 6, height = 5)
View(acs_data)
