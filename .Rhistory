# Installing required packages
packages <- c("tidyverse", "viridis", "stargazer")
to_install <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(to_install) > 0) install.packages(to_install)
lapply(packages, require, character.only = TRUE)
# Clean workspace
rm(list = ls())
# Set working directory
setwd("C:/Users/gustavoml/Desktop/Projects/FertilityFacts")
# Load intermediate datasets
women_1980_2022 <- read.csv("refined/cps_women_1980_2022.csv")
women_1980_2022 <- women_1980_2022 %>%
mutate(age_first_birth = fct_relevel(age_first_birth,
"< 19", "20-24", "25-29", "30-34", "35-39", "> 40"))
# Generating numbers for Fertility by Age at First Birth and Educational Attainment
total_fertility <- women_1980_2022 %>%
# Filter only women who ever gave birth and who have completed their fertility (between 45 and 50 y.o. for comparability)
filter(!(frever %in% c(0, 999)),
age %in% c(45:50)) %>%
group_by(year, age_first_birth) %>%
summarise(children_per_woman = weighted.mean(frever, wtfinl),
children_per_woman_unw = mean(frever),
n_women = n()) %>%
ungroup()
total_fertility %>%
filter(year %in% c(1980, 1990, 2016)) %>%
select(-children_per_woman_unw) %>%
pivot_wider(names_from = year, values_from = c(children_per_woman, n_women))
wide_fertility <- total_fertility %>%
filter(year %in% c(1980, 1990, 2016)) %>%
select(-children_per_woman_unw) %>%
pivot_wider(names_from = year, values_from = c(children_per_woman, n_women))
sample_size <- wide_fertility %>%
select(age_first_birth, starts_with("n_")) %>%
mutate(across(starts_with("n_"), ~ as.double(.x))) %>%
rename_with(~ sub("n_women_", "", .), starts_with("n_"))
total_fertility_by_age <- wide_fertility %>%
select(age_first_birth:children_per_woman_2016) %>%
rename_with(~ sub("children_per_woman_", "", .), starts_with("children_"))
rbind(total_fertility_by_age, sample_size) %>%
arrange(age_first_birth)
# Installing required packages
packages <- c("tidyverse", "viridis", "knitr", "kableExtra")
to_install <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(to_install) > 0) install.packages(to_install)
lapply(packages, require, character.only = TRUE)
# Clean workspace
rm(list = ls())
# Load intermediate datasets
women_1980_2022 <- read.csv("refined/cps_women_1980_2022.csv")
women_1980_2022 <- women_1980_2022 %>%
mutate(age_first_birth = fct_relevel(age_first_birth,
"< 19", "20-24", "25-29", "30-34", "35-39", "> 40"))
# Generating numbers for Fertility by Age at First Birth and Educational Attainment
total_fertility <- women_1980_2022 %>%
# Filter only women who ever gave birth and who have completed their fertility (between 45 and 50 y.o. for comparability)
filter(!(frever %in% c(0, 999)),
age %in% c(45:50)) %>%
group_by(year, age_first_birth) %>%
summarise(children_per_woman = weighted.mean(frever, wtfinl),
children_per_woman_unw = mean(frever),
n_women = n()) %>%
ungroup()
table <- rbind(total_fertility_by_age, sample_size) %>%
arrange(age_first_birth)
wide_fertility <- total_fertility %>%
filter(year %in% c(1980, 1990, 2016)) %>%
select(-children_per_woman_unw) %>%
pivot_wider(names_from = year, values_from = c(children_per_woman, n_women))
sample_size <- wide_fertility %>%
select(age_first_birth, starts_with("n_")) %>%
mutate(across(starts_with("n_"), ~ as.double(.x))) %>%
rename_with(~ sub("n_women_", "", .), starts_with("n_"))
total_fertility_by_age <- wide_fertility %>%
select(age_first_birth:children_per_woman_2016) %>%
rename_with(~ sub("children_per_woman_", "", .), starts_with("children_"))
table <- rbind(total_fertility_by_age, sample_size) %>%
arrange(age_first_birth)
table %>%
kable()
table %>%
kable(format = "latex")
?kable()
table
table %>%
kable(format = "latex",
col.names = c("", "1980", "1990", "2016"))
View(total_fertility)
